{
  "version": 3,
  "sources": ["../../../ui-src/main.ts"],
  "sourcesContent": ["/*\n * Table of contents\n *\n * - Utilities\n * - Selection stuff\n * - Project metadata\n * - Documents list\n * - Add document\n * - Tags list\n * - Highlights\n * - Add highlight\n * - Members\n * - Load contents\n * - Long polling\n\n\n/*\n * Utilities\n */\n\nif(!Object.entries) {\n  Object.entries = function<T>(obj: {[k: string]: T}): [string, T][] {\n    const ownProps = Object.keys(obj);\n    let i = ownProps.length;\n    const resArray = new Array(i); // preallocate the Array\n    while(i--) {\n      resArray[i] = [ownProps[i], obj[ownProps[i]]];\n    }\n\n    return resArray;\n  };\n}\n\nfunction sortByKey<T>(array: T[], key: (key: T) => number): void {\n  array.sort(function(a, b) {\n    if(key(a) < key(b)) {\n      return -1;\n    } else if(key(a) > key(b)) {\n      return 1;\n    } else {\n      return 0;\n    }\n  });\n}\n\nfunction encodeGetParams(params: {[k: string]: string}): string {\n  return Object.entries(params)\n    .filter(function(kv) { return kv[1] !== undefined; })\n    .map(function(kv) { return kv.map(encodeURIComponent).join(\"=\"); })\n    .join(\"&\");\n}\n\n// Don't use RegExp literals https://github.com/python-babel/babel/issues/640\nconst _escapeA = new RegExp('&', 'g'),\n      _escapeL = new RegExp('<', 'g'),\n      _escapeG = new RegExp('>', 'g'),\n      _escapeQ = new RegExp('\"', 'g'),\n      _escapeP = new RegExp(\"'\", 'g');\nfunction escapeHtml(s: string): string {\n  return s\n    .replace(_escapeA, \"&amp;\")\n    .replace(_escapeL, \"&lt;\")\n    .replace(_escapeG, \"&gt;\")\n    .replace(_escapeQ, \"&quot;\")\n    .replace(_escapeP, \"&#039;\");\n}\n\nfunction nextElement(node: Node | null): Node | null {\n  while(node && !node.nextSibling) {\n    node = node.parentNode;\n  }\n  if(!node) {\n    return null;\n  }\n  // If the loop above finished, either !node or node.nextSibling != null\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  node = node.nextSibling!;\n  while(node.firstChild) {\n    node = node.firstChild;\n  }\n  return node;\n}\n\nfunction getScrollPos() {\n  const doc = document.scrollingElement || document.documentElement, body = document.body;\n  const x = (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc.clientLeft || 0);\n  const y = (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc.clientTop || 0);\n  return {x: x, y: y};\n}\n\nfunction getCookie(name: string): string | undefined {\n  const r = document.cookie.match(\"\\\\b\" + name + \"=([^;]*)\\\\b\");\n  return r ? r[1] : undefined;\n}\n\nclass ApiError {\n  status: number;\n  message: string;\n\n  constructor(response: Response, message?: string) {\n    if(!message) {\n      message = \"Status \" + response.status;\n    }\n    this.status = response.status;\n    this.message = message;\n  }\n\n  toString() {\n    return this.message;\n  }\n}\n\nfunction getJSON(url='', args?: {[k: string]: string}) {\n  let query = '';\n  if(args) {\n    query = '?' + encodeGetParams(args);\n  }\n  return fetch(\n    url + query,\n    {\n      credentials: 'same-origin',\n      mode: 'same-origin',\n      redirect: 'error'\n    }\n  ).then(function(response) {\n    if(response.status != 200) {\n      return response.json()\n      .then(\n      function(json) {\n        if(\"error\" in json) {\n          throw new ApiError(response, json.error);\n        } else {\n          throw new ApiError(response);\n        }\n      },\n      function() {\n        throw new ApiError(response);\n      }\n      );\n    }\n    return response.json().catch(function() { throw new ApiError(response, \"Invalid JSON\"); });\n  });\n}\n\nfunction deleteURL(url='', args?: {[k: string]: string}) {\n  let query = ''\n  if(args) {\n    query = encodeGetParams(args);\n  }\n  const xsrf = getCookie('_xsrf');\n  return fetch(\n    url + '?' + (xsrf !== undefined ? '_xsrf=' + encodeURIComponent(xsrf) + '&' : '') + query,\n    {\n      credentials: 'same-origin',\n      mode: 'same-origin',\n      cache: 'no-cache',\n      redirect: 'error',\n      method: 'DELETE'\n    }\n  ).then(function(response) {\n    if(response.status != 204) {\n      throw new ApiError(response);\n    }\n  });\n}\n\nfunction postJSON(url='', data={}, args?: {[k: string]: string}) {\n  let query = ''\n  if(args) {\n    query = encodeGetParams(args);\n  }\n  const xsrf = getCookie('_xsrf');\n  return fetch(\n    url + '?' + (xsrf !== undefined ? '_xsrf=' + encodeURIComponent(xsrf) + '&' : '') + query,\n    {\n      credentials: 'same-origin',\n      mode: 'same-origin',\n      cache: 'no-cache',\n      redirect: 'error',\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8'\n      },\n      body: JSON.stringify(data)\n    }\n  ).then(function(response) {\n    if(response.status != 200) {\n      return response.json()\n      .then(\n      function(json) {\n        if(\"error\" in json) {\n          throw new ApiError(response, json.error);\n        } else {\n          throw new ApiError(response);\n        }\n      },\n      function() {\n        throw new ApiError(response);\n      }\n      );\n    }\n    return response.json().catch(function() { throw new ApiError(response, \"Invalid JSON\"); });\n  });\n}\n\nfunction patchJSON(url='', data={}, args?: {[k: string]: string}) {\n  let query = ''\n  if(args) {\n    query = encodeGetParams(args);\n  }\n  const xsrf = getCookie('_xsrf');\n  return fetch(\n    url + '?' + (xsrf !== undefined ? '_xsrf=' + encodeURIComponent(xsrf) + '&' : '') + query,\n    {\n      credentials: 'same-origin',\n      mode: 'same-origin',\n      cache: 'no-cache',\n      redirect: 'error',\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8'\n      },\n      body: JSON.stringify(data)\n    }\n  ).then(function(response) {\n    if(response.status != 204) {\n      return response.json()\n      .then(\n      function(json) {\n        if(\"error\" in json) {\n          throw new ApiError(response, json.error);\n        } else {\n          throw new ApiError(response);\n        }\n      },\n      function() {\n        throw new ApiError(response);\n      }\n      );\n    } else {\n      return null;\n    }\n  });\n}\n\n// Returns the byte length of a string encoded in UTF-8\n// https://stackoverflow.com/q/5515869/711380\nconst lengthUTF8 = (function() {\n  if(window.TextEncoder) {\n    return function lengthUTF8(s: string) {\n      return (new TextEncoder('utf-8').encode(s)).length;\n    }\n  } else {\n    return function lengthUTF8(s: string) {\n      let l = s.length;\n      for(let i = s.length - 1; i >= 0; --i) {\n        const code = s.charCodeAt(i);\n        if(code > 0x7f && code <= 0x7ff) ++l;\n        else if(code > 0x7ff && code <= 0xffff) l += 2;\n        if (code >= 0xDC00 && code <= 0xDFFF) i--; // trailing surrogate\n      }\n      return l;\n    }\n  }\n})();\n\nwindow.addEventListener('load', function() {\n  // https://css-tricks.com/snippets/jquery/draggable-without-jquery-ui/\n  (function($) {\n    $.fn.drags = function(opt) {\n      opt = $.extend({handle:\"\",cursor:\"move\"}, opt);\n      if(opt.handle === \"\") {\n          var $el = this;\n      } else {\n          var $el = this.find(opt.handle);\n      }\n\n      return $el.css('cursor', opt.cursor).on(\"mousedown\", function(e) {\n        if(opt.handle === \"\") {\n          var $drag = $(this).addClass('draggable');\n        } else {\n          var $drag = $(this).addClass('active-handle').parent().addClass('draggable');\n        }\n        var z_idx = $drag.css('z-index'),\n            drg_h = $drag.outerHeight(),\n            drg_w = $drag.outerWidth(),\n            pos_y = $drag.offset().top + drg_h - e.pageY,\n            pos_x = $drag.offset().left + drg_w - e.pageX;\n        $drag.css('z-index', 1000).parents().on(\"mousemove\", function(e) {\n          $('.draggable').offset({\n            top:e.pageY + pos_y - drg_h,\n            left:e.pageX + pos_x - drg_w\n          }).on(\"mouseup\", function() {\n            $(this).removeClass('draggable').css('z-index', z_idx);\n          });\n        });\n        e.preventDefault(); // disable selection\n      }).on(\"mouseup\", function() {\n        if(opt.handle === \"\") {\n          $(this).removeClass('draggable');\n        } else {\n          $(this).removeClass('active-handle').parent().removeClass('draggable');\n        }\n      });\n    }\n  })(jQuery);\n});\n\nfunction showSpinner() {\n  $('#spinner-modal').modal('show');\n}\n\nfunction hideSpinner() {\n  $('#spinner-modal').modal('hide');\n}\n\n\n/*\n * Selection stuff\n */\n\nlet chunk_offsets: number[] = [];\n\n// Get the document offset from a position\nfunction describePos(node: HTMLElement, offset: number): number | null {\n  // Convert current offset from character to bytes\n  offset = lengthUTF8(node.textContent.substring(0, offset));\n  while(!node.id) {\n    if(node.previousSibling) {\n      node = node.previousSibling;\n      offset += lengthUTF8(node.textContent);\n    } else {\n      node = node.parentNode;\n    }\n  }\n  if(node.id.substring(0, 11) != 'doc-offset-') {\n    return null;\n  }\n  return parseInt(node.id.substring(11)) + offset;\n}\n\n// Find a position from the document offset\nfunction locatePos(pos: number): [Node, number] {\n  // Find the right chunk\n  var chunk_start = 0;\n  for(var i = 0; i < chunk_offsets.length; ++i) {\n    if(chunk_offsets[i] > pos) {\n      break;\n    }\n    chunk_start = chunk_offsets[i];\n  }\n\n  var offset = pos - chunk_start;\n  var node = document.getElementById('doc-offset-' + chunk_start);\n  while(node.firstChild) {\n    node = node.firstChild;\n  }\n  while(offset > 0) {\n    if(lengthUTF8(node.textContent) >= offset) {\n      break;\n    } else {\n      offset -= lengthUTF8(node.textContent);\n      node = nextElement(node);\n    }\n  }\n  return [node, offset]\n}\n\nlet current_selection = null;\n\n// Describe the selection e.g. [14, 56]\nfunction describeSelection(): [number, number] | null {\n  const sel = window.getSelection();\n  if(sel && sel.rangeCount != 0) {\n    const range = sel.getRangeAt(0);\n    if(!range.collapsed) {\n      const start = describePos(range.startContainer, range.startOffset);\n      const end = describePos(range.endContainer, range.endOffset);\n      if(start !== null && end !== null) {\n        return [start, end];\n      }\n    }\n  }\n  return null;\n}\n\n// Restore a described selection\nfunction restoreSelection(saved: [number, number] | null) {\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  if(saved !== null) {\n    const range = document.createRange();\n    const start = locatePos(saved[0]);\n    const end = locatePos(saved[1]);\n    range.setStart(start[0], start[1]);\n    range.setEnd(end[0], end[1]);\n    sel.addRange(range);\n  }\n}\n\nfunction splitAtPos(pos: [HTMLElement, number], after: boolean) {\n  let [node, idx] = pos;\n  if(idx === 0) {\n    // Leftmost index: return current node\n    return node;\n  } else if(idx >= lengthUTF8(node.textContent)) {\n    // Rightmost index: return next node\n    return nextElement(node);\n  } else {\n    // Find the character index from the byte index\n    let idx_char = 0;\n    while(idx > 0) {\n      const code = node.textContent.charCodeAt(idx_char);\n      if(code <= 0x7f) idx -= 1;\n      else if(code <= 0x7ff) idx -= 2;\n      else if(code <= 0xffff) idx -= 3;\n      else idx -= 4;\n      idx_char += 1;\n    }\n    if(idx_char >= node.textContent.length) {\n      console.error(\"Error computing character position!\");\n      idx_char = node.textContent.length - 1;\n    }\n    // Split, return right node\n    return node.splitText(idx_char);\n  }\n}\n\n// Highlight a described selection\nfunction highlightSelection(saved, id, clickedCallback, title) {\n  console.log(\"Highlighting\", saved);\n  if(saved === null) {\n    return;\n  }\n  var start = locatePos(saved[0]);\n  start = splitAtPos(start, false);\n  var end = locatePos(saved[1]);\n  end = splitAtPos(end, true);\n\n  var node = start;\n  while(node != end) {\n    var next = nextElement(node);\n    if(node.nodeType == 3 && node.textContent) { // TEXT_NODE\n      var span = document.createElement('a');\n      span.className = 'highlight highlight-' + id;\n      span.setAttribute('data-highlight-id', '' + id);\n      span.setAttribute('title', title);\n      span.addEventListener('click', clickedCallback);\n      node.parentNode.insertBefore(span, node);\n      span.appendChild(node);\n    }\n    node = next;\n  }\n}\n\n\n/*\n * Project metadata\n */\n\nvar project_name_input = document.getElementById('project-name');\nvar project_name = project_name_input.value;\n\nvar project_description_input = document.getElementById('project-description');\nvar project_description = project_description_input.value;\n\nfunction setProjectMetadata(metadata, form=true) {\n  if(project_name == metadata.project_name\n   && project_description == metadata.description) {\n    return;\n  }\n  // Update globals\n  project_name = metadata.project_name;\n  project_description = metadata.description;\n  // Update form\n  if(form) {\n    project_name_input.value = project_name;\n    project_description_input.value = project_description;\n  }\n  // Update elements\n  var elems = document.getElementsByClassName('project-name');\n  for(var i = 0; i < elems.length; ++i) {\n    elems[i].textContent = project_name;\n  }\n  console.log(\"Project metadata updated\");\n}\n\nfunction projectMetadataChanged() {\n  if(project_name_input.value != project_name\n   || project_description_input.value != project_description) {\n    console.log(\"Posting project metadata update\");\n    var meta = {\n      name: project_name_input.value,\n      description: project_description_input.value\n    };\n    postJSON(\n      '/api/project/' + project_id,\n      meta\n    )\n    .then(function(result) {\n      setProjectMetadata(meta, false);\n    })\n    .catch(function(error) {\n      console.error(\"Failed to update project metadata:\", error);\n      alert(gettext(\"Couldn't update project metadata!\") + \"\\n\\n\" + error);\n      project_name_input.value = project_name;\n      project_description_input.value = project_description;\n    });\n  }\n}\n\ndocument.getElementById('project-metadata-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n  projectMetadataChanged();\n});\nproject_name_input.addEventListener('blur', projectMetadataChanged);\nproject_description_input.addEventListener('blur', projectMetadataChanged);\n\n\n/*\n * Documents list\n */\n\nvar current_document = null;\nvar current_tag = null;\nvar documents_list = document.getElementById('documents-list');\n\nfunction linkDocument(elem, doc_id) {\n  var url = '/project/' + project_id + '/document/' + doc_id;\n  elem.setAttribute('href', url);\n  elem.addEventListener('click', function(e) {\n    e.preventDefault();\n    window.history.pushState({document_id: doc_id}, \"Document \" + doc_id, url);\n    loadDocument(doc_id);\n  });\n}\n\nfunction updateDocumentsList() {\n  // Empty the list\n  while(documents_list.firstChild) {\n    var first = documents_list.firstChild;\n    if(first.classList\n     && first.classList.contains('special-item-button')) {\n      break;\n    }\n    documents_list.removeChild(first);\n  }\n\n  // Fill up the list again\n  var before = documents_list.firstChild;\n  var entries = Object.entries(documents);\n  sortByKey(entries, function(e) { return e[1].name; });\n  for(var i = 0; i < entries.length; ++i) {\n    var doc = entries[i][1];\n    var elem = document.createElement('li');\n    elem.setAttribute('id', 'document-link-' + doc.id);\n    elem.className = 'list-group-item document-link';\n    elem.innerHTML =\n      '<div class=\"d-flex justify-content-between align-items-center\">' +\n      '  <a class=\"document-link-a\">' + escapeHtml(doc.name) + '</a>' +\n      '  <a href=\"javascript:editDocument(' + doc.id + ');\" class=\"btn btn-primary btn-sm\">' + gettext(\"Edit\") + '</a>' +\n      '</div>';\n    documents_list.insertBefore(elem, before);\n    var links = elem.getElementsByTagName('a');\n    linkDocument(links[0], doc.id);\n  }\n  if(entries.length == 0) {\n    var elem = document.createElement('div');\n    elem.className = 'list-group-item disabled';\n    elem.textContent = gettext(\"There are no documents in this project yet.\");\n    documents_list.insertBefore(elem, before);\n  }\n  console.log(\"Documents list updated\");\n}\n\nupdateDocumentsList();\n\nfunction addDocument(document) {\n  documents['' + document.id] = document;\n  if(document.id === current_document) {\n    // Text direction is the only meaningful thing that can be mutated\n    if(document.text_direction === 'RIGHT_TO_LEFT') {\n      document_contents.style.direction = 'rtl';\n    } else {\n      document_contents.style.direction = 'ltr';\n    }\n  }\n  updateDocumentsList();\n}\n\nfunction removeDocument(document_id) {\n  delete documents['' + document_id];\n  updateDocumentsList();\n  if(current_document == document_id) {\n    window.history.pushState({}, \"Project\", '/project/' + project_id);\n    loadDocument(null);\n  }\n}\n\n\n/*\n * Add document\n */\n\nvar document_add_modal = document.getElementById('document-add-modal');\n\nfunction createDocument() {\n  document.getElementById('document-add-form').reset();\n  $(document_add_modal).modal();\n}\n\nfunction basename(filename) {\n  if(filename) {\n    var idx = Math.max(filename.lastIndexOf('/'), filename.lastIndexOf('\\\\'));\n    if(idx > -1) {\n      filename = filename.substring(idx + 1);\n    }\n  }\n  return filename;\n}\n\ndocument.getElementById('document-add-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n  console.log(\"Uploading document...\");\n\n  var form_data = new FormData();\n  var name = document.getElementById('document-add-name').value;\n  if(!name) {\n    name = basename(document.getElementById('document-add-file').value);\n  }\n  form_data.append('name', name);\n  form_data.append('description',\n                   document.getElementById('document-add-description').value);\n  form_data.append('file',\n                   document.getElementById('document-add-file').files[0]);\n  form_data.append('text_direction',\n                   document.getElementById('document-add-form').elements['document-add-direction'].value);\n  form_data.append('_xsrf', getCookie('_xsrf'));\n\n  var xhr = new XMLHttpRequest();\n  xhr.responseType = 'json';\n  xhr.open('POST', '/api/project/' + project_id + '/document/new');\n  showSpinner();\n  xhr.onload = function() {\n    if(xhr.status == 200) {\n      $(document_add_modal).modal('hide');\n      document.getElementById('document-add-form').reset();\n      console.log(\"Document upload complete\");\n    } else {\n      console.error(\"Document upload failed: status\", xhr.status);\n      var error = null;\n      try {\n        error = xhr.response.error;\n      } catch(e) {\n      }\n      if(!error) {\n        error = \"Status \" + xhr.status;\n      }\n      alert(gettext(\"Error uploading file!\") + \"\\n\\n\" + error);\n    }\n    hideSpinner();\n  };\n  xhr.onerror = function(e) {\n    console.log(\"Document upload failed:\", e);\n    alert(gettext(\"Error uploading file!\"));\n    hideSpinner();\n  }\n  xhr.send(form_data);\n});\n\n\n/*\n * Change document\n */\n\nvar document_change_modal = document.getElementById('document-change-modal');\n\nfunction editDocument(doc_id) {\n  document.getElementById('document-change-form').reset();\n  document.getElementById('document-change-id').value = '' + doc_id;\n  document.getElementById('document-change-name').value = '' + documents['' + doc_id].name;\n  document.getElementById('document-change-description').value = '' + documents['' + doc_id].description;\n  document.getElementById('document-change-form').elements['document-change-direction'].value = documents['' + doc_id].text_direction;\n  $(document_change_modal).modal();\n}\n\ndocument.getElementById('document-change-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n  console.log(\"Changing document...\");\n\n  var update = {\n    name: document.getElementById('document-change-name').value,\n    description: document.getElementById('document-change-description').value,\n    text_direction: document.getElementById('document-change-form').elements['document-change-direction'].value\n  };\n  if(!update.name || update.name.length == 0) {\n    alert(gettext(\"Document name cannot be empty\"));\n    return;\n  }\n\n  var doc_id = document.getElementById('document-change-id').value;\n  showSpinner();\n  postJSON(\n    '/api/project/' + project_id + '/document/' + doc_id,\n    update\n  )\n  .then(function() {\n    console.log(\"Document update posted\");\n    $(document_change_modal).modal('hide');\n    document.getElementById('document-change-form').reset();\n  })\n  .catch(function(error) {\n    console.error(\"Failed to update document:\", error);\n    alert(gettext(\"Couldn't update document!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n});\n\ndocument.getElementById('document-change-delete').addEventListener('click', function(e) {\n  e.preventDefault();\n\n  var doc_id = document.getElementById('document-change-id').value;\n  if(!window.confirm(gettext(\"Are you sure you want to delete the document '%(doc)s'?\", {doc: documents[doc_id].name}))) {\n    return;\n  }\n  console.log(\"Deleting document \" + doc_id + \"...\");\n  deleteURL('/api/project/' + project_id + '/document/' + doc_id)\n  .then(function() {\n    console.log(\"Document deletion posted\");\n    $(document_change_modal).modal('hide');\n    document.getElementById('document-change-form').reset();\n  })\n  .catch(function(error) {\n    console.error(\"Failed to delete document:\", error);\n    alert(gettext(\"Couldn't delete document!\") + \"\\n\\n\" + error);\n  });\n});\n\n\n/*\n * Tags list\n */\n\nvar tags_list = document.getElementById('tags-list');\nvar tags_modal_list = document.getElementById('highlight-add-tags');\n\nfunction linkTag(elem, tag_path) {\n  var url = '/project/' + project_id + '/highlights/' + encodeURIComponent(tag_path);\n  elem.setAttribute('href', url);\n  elem.addEventListener('click', function(e) {\n    e.preventDefault();\n    window.history.pushState({tag_path: tag_path}, \"Tag \" + tag_path, url);\n    loadTag(tag_path);\n  });\n}\n\nlinkTag(document.getElementById('load-all-tags'), '');\n\nfunction addTag(tag) {\n  if(!('count' in tag) && tag.id in tags) {\n    tag.count = tags[tag.id].count;\n  } else if(!('count' in tag)) {\n    tag = Object.assign({'count': 0}, tag)\n  }\n  tags[tag.id] = tag;\n  updateTagsList();\n}\n\nfunction removeTag(tag_id) {\n  // Remove from list of tags\n  delete tags['' + tag_id];\n  // Remove from all highlights\n  var hl_entries = Object.entries(highlights);\n  for(var i = 0; i < hl_entries.length; ++i) {\n    var hl = hl_entries[i][1];\n    hl.tags = hl.tags.filter(function(v) { return v != tag_id; });\n  }\n  updateTagsList();\n}\n\nfunction mergeTags(tag_src, tag_dest) {\n  for(var id in highlights) {\n    var hl_tags = highlights[id].tags;\n\n    if(hl_tags.includes(tag_src)) {\n      // Remove src tag\n      var idx = hl_tags.indexOf(tag_src);\n      hl_tags.splice(idx, 1);\n\n      if(!hl_tags.includes(tag_dest)) {\n        // Add new tag\n        hl_tags.push(tag_dest);\n      }\n    }\n  }\n  delete tags['' + tag_src];\n  updateTagsList();\n}\n\nfunction updateTagsList() {\n  var entries = Object.entries(tags);\n  sortByKey(entries, function(e) { return e[1].path; });\n\n  // The list in the left panel\n\n  // Empty the list\n  while(tags_list.firstChild) {\n    var first = tags_list.firstChild;\n    if(first.classList\n     && first.classList.contains('special-item-button')) {\n      break;\n    }\n    tags_list.removeChild(first);\n  }\n  // Fill up the list again\n  // TODO: Show this as a tree\n  var tree = {};\n  var before = tags_list.firstChild;\n  for(var i = 0; i < entries.length; ++i) {\n    var tag = entries[i][1];\n    var elem = document.createElement('li');\n    elem.className = 'list-group-item';\n    if(current_tag !== null && tag.path.substr(0, current_tag.length) == current_tag) {\n      elem.classList.add('tag-current');\n    }\n    elem.innerHTML =\n      '<div class=\"d-flex justify-content-between align-items-center\">' +\n      '  <div class=\"tag-name\">' +\n      '    <a id=\"tag-link-' + tag.id + '\">' + escapeHtml(tag.path) + '</a>' +\n      '  </div>' +\n      '  <div style=\"white-space: nowrap;\">' +\n      '    <span class=\"badge badge-secondary badge-pill\" id=\"tag-' + tag.id + '-count\">' + tag.count + '</span>' +\n      '    <a href=\"javascript:editTag(' + tag.id + ');\" class=\"btn btn-primary btn-sm\">' + gettext(\"Edit\") + '</a>' +\n      '  </div>' +\n      '</div>';\n    tags_list.insertBefore(elem, before);\n    linkTag(document.getElementById('tag-link-' + tag.id), tag.path);\n  }\n  if(entries.length == 0) {\n    var elem = document.createElement('div');\n    elem.className = 'list-group-item disabled';\n    elem.textContent = gettext(\"There are no tags in this project yet.\");\n    tags_list.insertBefore(elem, before);\n  }\n\n  // The list in the highlight modal\n\n  // Empty the list\n  while(tags_modal_list.firstChild) {\n    var first = tags_modal_list.firstChild;\n    if(first.classList\n     && first.classList.contains('special-item-button')) {\n      break;\n    }\n    tags_modal_list.removeChild(first);\n  }\n  // Fill up the list again\n  // TODO: Show this as a tree\n  var tree = {};\n  var before = tags_modal_list.firstChild;\n  for(var i = 0; i < entries.length; ++i) {\n    var tag = entries[i][1];\n    var elem = document.createElement('li');\n    elem.className = 'tag-name form-check';\n    elem.innerHTML =\n      '<input type=\"checkbox\" class=\"form-check-input\" value=\"' + tag.id + '\" name=\"highlight-add-tags\" id=\"highlight-add-tags-' + tag.id + '\" />' +\n      '<label for=\"highlight-add-tags-' + tag.id + '\" class=\"form-check-label\">' + escapeHtml(tag.path) + '</label>';\n    tags_modal_list.insertBefore(elem, before);\n  }\n  if(entries.length == 0) {\n    var elem = document.createElement('li');\n    elem.textContent = gettext(\"no tags\");\n    tags_modal_list.insertBefore(elem, before);\n  }\n\n  console.log(\"Tags list updated\");\n\n  // Re-set all highlights, to update titles\n  var hl_entries = Object.entries(highlights);\n  for(var i = 0; i < hl_entries.length; ++i) {\n    setHighlight(hl_entries[i][1]);\n  }\n\n  console.log(\"Highlights updated\");\n}\n\nupdateTagsList();\n\nfunction updateTagCount(id, delta) {\n  var tag = tags['' + id];\n  tag.count += delta;\n  var elem = document.getElementById('tag-' + id + '-count');\n  elem.textContent = tag.count;\n}\n\nvar tag_add_modal = document.getElementById('tag-add-modal');\n\nfunction createTag() {\n  document.getElementById('tag-add-form').reset();\n  document.getElementById('tag-add-id').value = '';\n  document.getElementById('tag-add-label-new').style.display = '';\n  document.getElementById('tag-add-label-change').style.display = 'none';\n  document.getElementById('tag-add-cancel').style.display = '';\n  document.getElementById('tag-add-delete').style.display = 'none';\n  document.getElementById('tag-add-merge').style.display = 'none';\n  $(tag_add_modal).modal();\n}\n\nfunction editTag(tag_id) {\n  document.getElementById('tag-add-form').reset();\n  document.getElementById('tag-add-id').value = '' + tag_id;\n  document.getElementById('tag-add-path').value = tags['' + tag_id].path;\n  document.getElementById('tag-add-description').value = tags['' + tag_id].description;\n  document.getElementById('tag-add-label-new').style.display = 'none';\n  document.getElementById('tag-add-label-change').style.display = '';\n  document.getElementById('tag-add-cancel').style.display = 'none';\n  document.getElementById('tag-add-delete').style.display = '';\n  document.getElementById('tag-add-merge').style.display = '';\n  $(tag_add_modal).modal();\n}\n\n// Save tag button\ndocument.getElementById('tag-add-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n\n  var tag_id = document.getElementById('tag-add-id').value;\n  if(tag_id) {\n    tag_id = parseInt(tag_id);\n  } else {\n    tag_id = null;\n  }\n  var tag_path = document.getElementById('tag-add-path').value;\n  if(!tag_path) {\n    alert(gettext(\"Invalid tag name\"));\n    return;\n  }\n  var req;\n  if(tag_id !== null) {\n    console.log(\"Posting update for tag \" + tag_id);\n    req = postJSON(\n      '/api/project/' + project_id + '/tag/' + tag_id,\n      {path: tag_path,\n       description: document.getElementById('tag-add-description').value}\n    );\n  } else {\n    console.log(\"Posting new tag\");\n    req = postJSON(\n      '/api/project/' + project_id + '/tag/new',\n      {path: tag_path,\n       description: document.getElementById('tag-add-description').value}\n    );\n  }\n  showSpinner();\n  req.then(function() {\n    console.log(\"Tag posted\");\n    $(tag_add_modal).modal('hide');\n    document.getElementById('tag-add-form').reset();\n  })\n  .catch(function(error) {\n    console.error(\"Failed to create tag:\", error);\n    alert(gettext(\"Couldn't create tag!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n});\n\n// Delete tag button\ndocument.getElementById('tag-add-delete').addEventListener('click', function(e) {\n  var tag_id = document.getElementById('tag-add-id').value;\n  if(tag_id) {\n    if(!window.confirm(gettext(\"Are you sure you want to delete the tag '%(tag)s'?\", {tag: tags[tag_id].path}))) {\n      e.preventDefault();\n      return;\n    }\n    tag_id = parseInt(tag_id);\n    console.log(\"Posting tag \" + tag_id + \" deletion\");\n    deleteURL(\n      '/api/project/' + project_id + '/tag/' + tag_id\n    )\n    .then(function() {\n      $(tag_add_modal).modal('hide');\n      document.getElementById('tag-add-form').reset();\n    })\n    .catch(function(error) {\n      console.error(\"Failed to delete tag:\", error);\n      alert(gettext(\"Couldn't delete tag!\") + \"\\n\\n\" + error);\n    });\n  }\n});\n\n// Merge tags button in tag edit modal: shows merge modal\ndocument.getElementById('tag-add-merge').addEventListener('click', function(e) {\n  var tag_id = document.getElementById('tag-add-id').value;\n  if(!tag_id)\n    return;\n  tag_id = parseInt(tag_id);\n\n  document.getElementById('tag-merge-form').reset();\n\n  // Set source tag\n  document.getElementById('tag-merge-src-id').value = '' + tag_id;\n  document.getElementById('tag-merge-src-name').value = tags['' + tag_id].path;\n\n  // Empty target tag <select>\n  var target = document.getElementById('tag-merge-dest');\n  target.innerHTML = '';\n\n  // Fill target tag <select>\n  var entries = Object.entries(tags);\n  sortByKey(entries, function(e) { return e[1].path; });\n  for(var i = 0; i < entries.length; ++i) {\n    if(entries[i][0] == '' + tag_id) {\n      // Can't merge into itself\n      continue;\n    }\n    var option = document.createElement('option');\n    option.setAttribute('value', entries[i][0]);\n    option.innerText = entries[i][1].path;\n    target.appendChild(option);\n  }\n\n  $(document.getElementById('tag-merge-modal')).modal();\n});\n\n// Merge modal submit button\ndocument.getElementById('tag-merge-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n\n  var tag_src = document.getElementById('tag-merge-src-id').value;\n  if(!tag_src)\n    return;\n  tag_src = parseInt(tag_src);\n\n  var tag_dest = document.getElementById('tag-merge-dest').value;\n  if(!tag_dest)\n    return;\n  tag_dest = parseInt(tag_dest);\n\n  console.log(\n    \"Merging tag \" + tag_src + \" (\" + tags['' + tag_src].path +\n    \") into tag \" + tag_dest + \" (\" + tags['' + tag_dest].path + \")\");\n  showSpinner();\n  postJSON(\n    '/api/project/' + project_id + '/tag/merge',\n    {src: tag_src, dest: tag_dest}\n  )\n  .then(function() {\n    console.log(\"Tag merge posted\");\n    $(document.getElementById('tag-merge-modal')).modal('hide');\n  })\n  .catch(function(error) {\n    console.error(\"Failed to merge tags:\", error);\n    alert(gettext(\"Couldn't merge tags!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n});\n\n\n/*\n * Highlights\n */\n\n// Add or replace a highlight\nfunction setHighlight(highlight) {\n  var id = '' + highlight.id;\n  if(highlights[id]) {\n    removeHighlight(id);\n  }\n  highlights[id] = highlight;\n  var tag_names = highlight.tags.map(function(id) { return tags[id].path; });\n  sortByKey(tag_names, function(path) { return path; });\n  tag_names = tag_names.join(\", \");\n  try {\n    highlightSelection([highlight.start_offset, highlight.end_offset], id, editHighlight, tag_names);\n    console.log(\"Highlight set:\", highlight);\n  } catch(error) {\n    console.error(\n      \"Error setting highlight \", highlight.id, \" \", [highlight.start_offset, highlight.end_offset],\n      \":\", error,\n    );\n  }\n}\n\n// Remove a highlight\nfunction removeHighlight(id) {\n  id = '' + id;\n  if(!highlights[id]) {\n    return;\n  }\n\n  var highlight = highlights[id];\n  delete highlights[id];\n  console.log(\"Highlight removed:\", id);\n\n  // Loop over highlight-<id> elements\n  var elements = document.getElementsByClassName('highlight-' + id);\n  for(var i = 0; i < elements.length; ++i) {\n    // Move children up and delete this element\n    var node = elements[i];\n    while(node.firstChild) {\n      node.parentNode.insertBefore(node.firstChild, node);\n    }\n    node.parentNode.removeChild(node);\n  }\n}\n\n// Backlight\nvar backlight_checkbox = document.getElementById('backlight');\nbacklight_checkbox.addEventListener('change', function(e) {\n  var classes = document.getElementById('document-view').classList;\n  if(backlight_checkbox.checked == classes.contains('backlight')) {\n    ; // all good\n  } else if(backlight_checkbox.checked) {\n    classes.add('backlight');\n  } else {\n    classes.remove('backlight');\n  }\n});\n\n\n/*\n * Add highlight\n */\n\nvar highlight_add_modal = document.getElementById('highlight-add-modal');\n\n// Updates current_selection and visibility of the controls\nfunction selectionChanged() {\n  current_selection = describeSelection();\n  if(current_selection !== null) {\n    var current_range = window.getSelection().getRangeAt(0);\n    if(current_range.endOffset > 0) {\n      var last_char_range = document.createRange();\n      last_char_range.setStart(current_range.endContainer, current_range.endOffset - 1);\n      last_char_range.setEnd(current_range.endContainer, current_range.endOffset);\n      var rect = last_char_range.getClientRects().item(0);\n      var scrollPos = getScrollPos();\n      hlinfo.style.left = ((rect.x || rect.left) + rect.width) + 'px';\n      hlinfo.style.top = ((rect.y || rect.top) + rect.height + scrollPos.y + 20) + 'px';\n      hlinfo.style.display = 'block';\n    } else {\n      // We are in a weird situation where the end of the selection is in\n      // an empty node. We just don't move the popup, seems to work in practice\n    }\n  } else {\n    document.getElementById('hlinfo').style.display = 'none';\n  }\n}\ndocument.addEventListener('selectionchange', selectionChanged);\n\nfunction createHighlight(selection) {\n  document.getElementById('highlight-add-id').value = '';\n  document.getElementById('highlight-add-start').value = selection[0];\n  document.getElementById('highlight-add-end').value = selection[1];\n  document.getElementById('highlight-add-form').reset();\n  $(highlight_add_modal).modal().drags({handle: '.modal-header'});\n}\n\nfunction editHighlight(e) {\n  document.getElementById('highlight-add-form').reset();\n  var id = this.getAttribute('data-highlight-id');\n  document.getElementById('highlight-add-id').value = id;\n  document.getElementById('highlight-add-start').value = highlights[id].start_offset;\n  document.getElementById('highlight-add-end').value = highlights[id].end_offset;\n  var hl_tags = highlights['' + id].tags;\n  for(var i = 0; i < hl_tags.length; ++i) {\n    document.getElementById('highlight-add-tags-' + hl_tags[i]).checked = true;\n  }\n  $(highlight_add_modal).modal().drags({handle: '.modal-header'});\n}\n\n// Save highlight button\ndocument.getElementById('highlight-add-form').addEventListener('submit', function(e) {\n  e.preventDefault();\n  var highlight_id = document.getElementById('highlight-add-id').value;\n  var selection = [\n    parseInt(document.getElementById('highlight-add-start').value),\n    parseInt(document.getElementById('highlight-add-end').value)\n  ];\n  var hl_tags = [];\n  var entries = Object.entries(tags);\n  for(var i = 0; i < entries.length; ++i) {\n    var id = entries[i][1].id;\n    if(document.getElementById('highlight-add-tags-' + id).checked) {\n      hl_tags.push(id);\n    }\n  }\n  var req;\n  if(highlight_id) {\n    console.log(\"Posting update for highlight \" + highlight_id);\n    req = postJSON(\n      '/api/project/' + project_id + '/document/' + current_document + '/highlight/' + highlight_id,\n      {start_offset: selection[0],\n       end_offset: selection[1],\n       tags: hl_tags}\n    );\n  } else {\n    console.log(\"Posting new highlight\");\n    req = postJSON(\n      '/api/project/' + project_id + '/document/' + current_document + '/highlight/new',\n      {start_offset: selection[0],\n       end_offset: selection[1],\n       tags: hl_tags}\n    );\n  }\n  showSpinner();\n  req.then(function() {\n    console.log(\"Highlight posted\");\n    $(highlight_add_modal).modal('hide');\n    document.getElementById('highlight-add-form').reset();\n  })\n  .catch(function(error) {\n    console.error(\"Failed to create highlight:\", error);\n    alert(gettext(\"Couldn't create highlight!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n});\n\n// Delete highlight button\ndocument.getElementById('highlight-delete').addEventListener('click', function(e) {\n  var highlight_id = document.getElementById('highlight-add-id').value;\n  if(highlight_id) {\n    highlight_id = parseInt(highlight_id);\n    console.log(\"Posting highlight \" + highlight_id + \" deletion\");\n    deleteURL(\n      '/api/project/' + project_id + '/document/' + current_document + '/highlight/' + highlight_id\n    )\n    .then(function() {\n      $(highlight_add_modal).modal('hide');\n      document.getElementById('highlight-add-form').reset();\n    })\n    .catch(function(error) {\n      console.error(\"Failed to delete highlight:\", error);\n      alert(gettext(\"Couldn't delete highlight!\") + \"\\n\\n\" + error);\n    });\n  }\n});\n\n\n/*\n * Members\n */\n\nfunction addMember(login, privileges) {\n  members[login] = {privileges: privileges};\n}\n\nfunction removeMember(login) {\n  delete members[login];\n}\n\nvar members_modal = document.getElementById('members-modal');\nvar members_initial = {};\nvar members_displayed = {};\n\nfunction _memberRow(login, user, can_edit, is_self) {\n  var elem = document.createElement('div');\n  elem.className = 'row members-item';\n  elem.innerHTML =\n    '<div class=\"col-md-4\">' +\n    '  <p class=\"members-item-login\">' + login + '</p>' +\n    '</div>' +\n    '<div class=\"col-md-4 form-group\">' +\n    '  <select class=\"form-control\"' + (can_edit?'':' disabled') + '>' +\n    '    <option value=\"ADMIN\">' + gettext(\"Full permissions\") + '</option>' +\n    '    <option value=\"MANAGE_DOCS\">' + gettext(\"Can't change collaborators / delete project\") + '</option>' +\n    '    <option value=\"TAG\">' + gettext(\"View & make changes\") + '</option>' +\n    '    <option value=\"READ\">' + gettext(\"View only\") + '</option>' +\n    '  </select>' +\n    '</div>' +\n    (is_self?\n    '<button type=\"button\" class=\"btn btn-danger col-md-4 form-group\">Leave project</button>'\n    :\n    '<button type=\"button\" class=\"btn btn-danger col-md-4 form-group\"' + (can_edit?'':' disabled') + '>Remove collaborator</button>'\n    );\n\n  [].forEach.call(elem.querySelectorAll('option'), function(e) {\n    if(e.value == user.privileges) {\n      e.selected = true;\n    }\n  });\n\n  elem.querySelector('button').addEventListener('click', function(e) {\n    elem.parentNode.removeChild(elem);\n    delete members_displayed[login];\n  });\n\n  return elem;\n}\n\nfunction showMembers() {\n  document.getElementById('members-add').reset();\n\n  can_edit = members[user_login].privileges == 'ADMIN';\n\n  if(can_edit) {\n    document.getElementById('members-add-fields').removeAttribute('disabled');\n  } else {\n    document.getElementById('members-add-fields').setAttribute('disabled', 1);\n  }\n\n  var entries = Object.entries(members);\n  sortByKey(entries, function(e) { return e[0]; });\n  console.log(\n    \"Members:\",\n    entries.map(function(e) { return e[0] + \" (\" + e[1].privileges + \")\"; })\n    .join(\", \")\n  );\n\n  // Empty the list\n  var current_members = document.getElementById('members-current');\n  current_members.innerHTML = '';\n\n  // Fill it back up\n  for(var i = 0; i < entries.length; ++i) {\n    var login = entries[i][0];\n    var user = entries[i][1];\n    var elem = _memberRow(login, user, can_edit, login == user_login);\n\n    current_members.appendChild(elem);\n  }\n\n  // Store current state so that we can compare later\n  members_initial = Object.assign({}, members);\n  members_displayed = Object.assign({}, members);\n\n  $(members_modal).modal();\n}\n\ndocument.getElementById('members-add').addEventListener('submit', function(e) {\n  e.preventDefault();\n\n  var login = document.getElementById('member-add-name').value.toLowerCase();\n  if(!login) { return; }\n  var privileges = document.getElementById('member-add-privileges').value;\n\n  // Check login\n  if(login in members_displayed) {\n    alert(gettext(\"Already a member!\"));\n    document.getElementById('members-add').reset();\n    return;\n  }\n  postJSON(\n    '/api/check_user',\n    {login: login}\n  )\n  .then(function(result) {\n    if(result.exists) {\n      // Add it at the top\n      var elem = _memberRow(login, {privileges: privileges});\n      var current_members = document.getElementById('members-current');\n      current_members.insertBefore(elem, current_members.firstChild);\n      members_displayed[login] = true;\n\n      document.getElementById('members-add').reset();\n    } else {\n      alert(gettext(\"This user doesn't exist!\"));\n    }\n  })\n});\n\nfunction sendMembersPatch() {\n  var patch = {};\n\n  var members_before = Object.assign({}, members_initial);\n\n  var rows = document.getElementById('members-current').querySelectorAll('.members-item');\n  for(var i = 0; i < rows.length; ++i) {\n    var row = rows[i];\n    var login = row.querySelector('.members-item-login').textContent;\n    var privileges = row.querySelector('select').value;\n\n    // Add to patch, if different from stored version\n    if(!members_before[login] || members_before[login].privileges != privileges) {\n      patch[login] = {privileges: privileges};\n    }\n\n    // Remove from object, so what's left are the removed members\n    delete members_before[login];\n  }\n\n  // Remove the members that are left\n  var entries = Object.entries(members_before);\n  for(var i = 0; i < entries.length; ++i) {\n    patch[entries[i][0]] = null;\n  }\n\n  console.log(\"Patching members list\");\n  showSpinner();\n  patchJSON(\n    '/api/project/' + project_id + '/members',\n    patch\n  )\n  .then(function() {\n    console.log(\"Members list patched\");\n    $(members_modal).modal('hide');\n  })\n  .catch(function(error) {\n    console.error(\"Failed to patch members list:\", error);\n    alert(gettext(\"Couldn't update collaborators!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n\n  members_initial = {};\n}\n\ndocument.getElementById('members-submit').addEventListener('click', function(e) {\n  e.preventDefault();\n  sendMembersPatch();\n});\n\ndocument.getElementById('members-current').addEventListener('submit', function(e) {\n  e.preventDefault();\n  sendMembersPatch();\n});\n\n\n/*\n * Load contents\n */\n\nvar document_contents = document.getElementById('document-contents');\nvar export_button = document.getElementById('export-button');\n\nfunction loadDocument(document_id) {\n  if(document_id === null) {\n    document_contents.style.direction = 'ltr';\n    document_contents.innerHTML = '<p style=\"font-style: oblique; text-align: center;\">' + gettext(\"Load a document on the left\") + '</p>';\n    return;\n  }\n  showSpinner();\n  getJSON(\n    '/api/project/' + project_id + '/document/' + document_id + '/content'\n  )\n  .then(function(result) {\n    document_contents.innerHTML = '';\n    highlights = {};\n    chunk_offsets = [];\n    for(var i = 0; i < result.contents.length; ++i) {\n      var chunk = result.contents[i];\n      var elem = document.createElement('div');\n      elem.setAttribute('id', 'doc-offset-' + chunk.offset);\n      elem.innerHTML = chunk.contents;\n      document_contents.appendChild(elem);\n      chunk_offsets.push(chunk.offset);\n    }\n    if(result.text_direction === 'RIGHT_TO_LEFT') {\n      document_contents.style.direction = 'rtl';\n    } else {\n      document_contents.style.direction = 'ltr';\n    }\n    current_document = document_id;\n    var document_links = document.getElementsByClassName('document-link-current');\n    for(var i = document_links.length - 1; i >= 0; --i) {\n      document_links[i].classList.remove('document-link-current');\n    }\n    document.getElementById('document-link-' + current_document).classList.add('document-link-current');\n    current_tag = null;\n    var tag_links = document.getElementsByClassName('tag-current');\n    for(var i = tag_links.length - 1; i >= 0; --i) {\n      tag_links[i].classList.remove('tag-current');\n    }\n    console.log(\"Loaded document\", document_id);\n    for(var i = 0; i < result.highlights.length; ++i) {\n      setHighlight(result.highlights[i]);\n    }\n    console.log(\"Loaded \" + result.highlights.length + \" highlights\");\n\n    // Update export button\n    export_button.style.display = '';\n    var items = export_button.getElementsByClassName('dropdown-item');\n    for(var i = 0; i < items.length; ++i) {\n      var ext = items[i].getAttribute('data-extension');\n      if(items[i].getAttribute('data-document') !== 'false') {\n        items[i].setAttribute(\n          'href',\n          '/project/' + project_id + '/export/document/' + document_id + '.' + ext,\n        );\n        items[i].style.display = '';\n      } else {\n        items[i].style.display = 'none';\n      }\n    }\n\n    // Scroll up\n    window.setTimeout(function() { window.scrollTo(0, 0); }, 0);\n  })\n  .catch(function(error) {\n    console.error(\"Failed to load document:\", error);\n    alert(gettext(\"Error loading document!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n}\n\nfunction loadTag(tag_path, page) {\n  if(page === undefined) {\n    page = 1;\n  }\n  showSpinner();\n  getJSON(\n    '/api/project/' + project_id + '/highlights/' + encodeURIComponent(tag_path) + '?page=' + page\n  )\n  .then(function(result) {\n    console.log(\"Loaded highlights for tag\", tag_path || \"''\");\n    document_contents.style.direction = 'ltr';\n    current_tag = tag_path;\n    current_document = null;\n    var document_links = document.getElementsByClassName('document-link-current');\n    for(var i = document_links.length - 1; i >= 0; --i) {\n      document_links[i].classList.remove('document-link-current');\n    }\n    // No need to clear the 'tag-current', we are calling updateTagsList() below\n    document_contents.innerHTML = '';\n    highlights = {};\n    for(var i = 0; i < result.highlights.length; ++i) {\n      var hl = result.highlights[i];\n      var content = document.createElement('div');\n      if(hl.text_direction === 'RIGHT_TO_LEFT') {\n        content.style.direction = 'rtl';\n      } else {\n        content.style.direction = 'ltr';\n      }\n      content.innerHTML = result.highlights[i].content;\n      var elem = document.createElement('div');\n      elem.className = 'highlight-entry';\n      elem.setAttribute('id', 'highlight-entry-' + hl.id);\n      elem.appendChild(content);\n      elem.appendChild(document.createTextNode(' '));\n\n      var doclink = document.createElement('a');\n      doclink.className = 'badge badge-light';\n      doclink.textContent = documents['' + hl.document_id].name;\n      linkDocument(doclink, hl.document_id);\n      elem.appendChild(doclink);\n      elem.appendChild(document.createTextNode(' '));\n\n      var tag_names = hl.tags.map(function(tag) { return tags['' + tag].path; });\n      tag_names.sort();\n      for(var j = 0; j < tag_names.length; ++j) {\n        if(j > 0) {\n          elem.appendChild(document.createTextNode(' '));\n        }\n        var taglink = document.createElement('a');\n        taglink.className = 'badge badge-dark';\n        taglink.textContent = tag_names[j];\n        linkTag(taglink, taglink.textContent);\n        elem.appendChild(taglink);\n      }\n\n      document_contents.appendChild(elem);\n    }\n    if(result.highlights.length == 0) {\n      document_contents.innerHTML = '<p style=\"font-style: oblique; text-align: center;\">' + gettext(\"No highlights with this tag yet.\") + '</p>';\n    }\n\n    // Pagination controls\n    function makePageLink(page_nb, label, current, enabled) {\n      var item;\n      if(current) {\n        item = document.createElement('li');\n        item.className = 'page-item active';\n        item.innerHTML = '<span class=\"page-link\">' + label + '<span class=\"sr-only\">(current)</span></span>';\n      } else if(!enabled) {\n        item = document.createElement('li');\n        item.className = 'page-item disabled';\n        item.innerHTML = '<span class=\"page-link\">' + label + '</span>';\n      } else {\n        item = document.createElement('li');\n        item.className = 'page-item';\n        var link = document.createElement('a');\n        link.className = 'page-link';\n        link.setAttribute('href', '#');\n        link.innerText = label;\n        link.addEventListener('click', function(e) {\n          e.preventDefault();\n          loadTag(tag_path, page_nb);\n        });\n        item.appendChild(link);\n      }\n      return item;\n    }\n    if(result.pages > 1 || page !== 1) {\n      if(result.pages === undefined && page !== 1) {\n        result.pages = 1;\n      }\n      pagination = document.createElement('nav');\n      pagination.setAttribute('aria-label', \"Page navigation\");\n      var pagination_ul = document.createElement('ul');\n      pagination_ul.className = 'pagination justify-content-center';\n      var min_page = Math.max(2, page - 2);\n      var max_page = Math.min(result.pages - 1, page + 2);\n\n      // Previous button\n      pagination_ul.appendChild(makePageLink(page - 1, \"Previous\", false, page > 1));\n      // Page 1\n      pagination_ul.appendChild(makePageLink(1, 1, 1 === page, 1 !== page));\n      // \"...\" between 1 and other pages, if appropriate\n      if(min_page > 2) {\n        pagination_ul.appendChild(makePageLink(page, \"...\", false, false));\n      }\n      // Other pages\n      for(var i = min_page; i <= max_page; ++i) {\n        pagination_ul.appendChild(makePageLink(i, i, i === page, i !== page));\n      }\n      // \"...\" between other pages and last page, if appropriate\n      if(max_page < result.pages - 1) {\n        pagination_ul.appendChild(makePageLink(page, \"...\", false, false));\n      }\n      // Last page\n      pagination_ul.appendChild(makePageLink(result.pages, result.pages, result.pages === page, result.pages !== page));\n      // Next button\n      pagination_ul.appendChild(makePageLink(page + 1, \"Next\", false, page < result.pages));\n\n      pagination.appendChild(pagination_ul);\n      document_contents.appendChild(pagination);\n    }\n\n    updateTagsList();\n\n    // Update export button\n    export_button.style.display = '';\n    var items = export_button.getElementsByClassName('dropdown-item');\n    for(var i = 0; i < items.length; ++i) {\n      var ext = items[i].getAttribute('data-extension');\n      if(items[i].getAttribute('data-highlights') !== 'false') {\n        items[i].setAttribute(\n          'href',\n          '/project/' + project_id + '/export/highlights/' + encodeURIComponent(tag_path) + '.' + ext,\n        );\n        items[i].style.display = '';\n      } else {\n        items[i].style.display = 'none';\n      }\n    }\n\n    // Scroll up\n    window.setTimeout(function() { window.scrollTo(0, 0); }, 0);\n  })\n  .catch(function(error) {\n    console.error(\"Failed to load tag highlights:\", error);\n    alert(gettext(\"Error loading tag highlights!\") + \"\\n\\n\" + error);\n  })\n  .then(hideSpinner);\n}\n\n// Load the document if the URL includes one\nsetTimeout(\n  function() {\n    var _document_url = new RegExp('/project/([0-9]+)/document/([0-9]+)');\n    // Don't use RegExp literals https://github.com/python-babel/babel/issues/640\n    var m = window.location.pathname.match(_document_url);\n    if(m) {\n      loadDocument(parseInt(m[2]));\n    }\n    // Or a tag\n    var _tag_url = new RegExp('/project/([0-9]+)/highlights/([^/]*)');\n    m = window.location.pathname.match(_tag_url);\n    if(m) {\n      loadTag(decodeURIComponent(m[2]));\n    }\n  },\n  0,\n);\n\n\n// Load documents as we go through browser history\nwindow.onpopstate = function(e) {\n  if(e.state) {\n    if(e.state.document_id !== undefined) {\n      loadDocument(e.state.document_id);\n    } else if(e.state.tag_path !== undefined) {\n      loadTag(e.state.tag_path);\n    } else {\n      loadDocument(null);\n    }\n  } else {\n    loadDocument(null);\n  }\n};\n\n\n/*\n * Long polling\n */\n\n// null: active now\n// Date: inactive since then\nvar windowLastActive = new Date();\nif(document.hasFocus()) {\n  windowLastActive = null; // Focused now\n}\n\nwindow.addEventListener('focus', function() {\n  // We are active as long as we have the focus\n  windowLastActive = null;\n  maybeResumePolling();\n});\nwindow.addEventListener('mousemove', function() {\n  if(windowLastActive !== null) {\n    // If the mouse moved over the window and we're not focused, refresh timer\n    windowLastActive = new Date();\n    maybeResumePolling();\n  }\n});\nwindow.addEventListener('blur', function() {\n  // We lost focus, start timer\n  windowLastActive = new Date();\n});\n\nvar lastPoll = null;\nvar polling = true;\n\nfunction maybeResumePolling() {\n  if(!polling) {\n    longPollForEvents();\n  }\n}\n\nfunction longPollForEvents() {\n  // If we've been inactive for 10min, pause polling for now\n  if(windowLastActive !== null && (new Date() - windowLastActive > 600000)) {\n    console.log(\"Browser window inactive, stop polling\");\n    polling = false;\n    return;\n  }\n\n  polling = true;\n  lastPoll = Date.now();\n  getJSON(\n    '/api/project/' + project_id + '/events',\n    {from: last_event}\n  )\n  .then(function(result) {\n    if(result.reload) {\n      console.log(\"Server sent signal to reload\");\n      window.location.reload();\n      return;\n    }\n    for(var i = 0; i < result.events.length; ++i) {\n      var event = result.events[i];\n      if(event.type === 'project_meta') {\n        setProjectMetadata({\n          project_name: event.project_name,\n          description: event.description\n        });\n      } else if(event.type === 'document_add') {\n        addDocument({\n          id: event.document_id,\n          name: event.document_name,\n          description: event.description,\n          text_direction: event.text_direction\n        });\n      } else if(event.type === 'document_delete') {\n        removeDocument(event.document_id);\n      } else if(event.type === 'highlight_add') {\n        setHighlight({\n          id: event.highlight_id,\n          start_offset: event.start_offset,\n          end_offset: event.end_offset,\n          tags: event.tags\n        });\n      } else if(event.type === 'highlight_delete') {\n        removeHighlight(event.highlight_id);\n      } else if(event.type === 'tag_add') {\n        addTag({\n          id: event.tag_id,\n          path: event.tag_path,\n          description: event.description\n        });\n      } else if(event.type === 'tag_delete') {\n        removeTag(event.tag_id);\n      } else if(event.type === 'tag_merge') {\n        mergeTags(event.src_tag_id, event.dest_tag_id);\n      } else if(event.type === 'member_add') {\n        addMember(event.member, event.privileges);\n      } else if(event.type === 'member_remove') {\n        removeMember(event.member);\n      }\n\n      if('tag_count_changes' in event) {\n        var entries = Object.entries(event.tag_count_changes);\n        for(var i = 0; i < entries.length; ++i) {\n          updateTagCount(entries[i][0], entries[i][1]);\n        }\n      }\n      last_event = event.id;\n    }\n\n    // Re-open connection\n    setTimeout(longPollForEvents, 1);\n  }, function(error) {\n    console.error(\"Polling failed:\", error);\n    if(error instanceof ApiError && error.status == 403) {\n      alert(gettext(\"It appears that you have been logged out.\"));\n      window.location = '/';\n    } else if(error instanceof ApiError && error.status == 404) {\n      alert(gettext(\"You can no longer access this project.\"));\n      window.location = '/';\n    } else {\n      setTimeout(longPollForEvents, Math.max(1, 5000 + lastPoll - Date.now()));\n    }\n  })\n  .catch(function(error) {\n    console.error(\"Polling function error:\", error);\n  });\n}\nlongPollForEvents();\n"],
  "mappings": "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",
  "names": []
}
