(function(){"use strict";var e={673:function(e,t,s){var r=s(538),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("trame-connect",{attrs:{"use-url":"","forward-errors":""}},[s("trame-server-template",{attrs:{"use-url":""}})],1)},i=[],a=function(){var e=this,t=e.$createElement;e._self._c;return e.ready?e._t("default"):e._e()},o=[],c=(s(6699),s(7807)),l=s(8923),u=s(6215),h=e=>({getArray(t,s=!0){return e.call("viewport.geometry.array.get",[t,s])},getViewState(t,s=!1){return e.call("viewport.geometry.view.get.state",[t,s])},addViewObserver(t){return e.call("viewport.geometry.view.observer.add",[t])},removeViewObserver(t){return e.call("viewport.geometry.view.observer.remove",[t])},subscribeToViewChange(t){return e.subscribe("viewport.geometry.view.subscription",t)},unsubscribe(t){return e.unsubscribe(t)}}),m=e=>({lifeCycleUpdate(t){return e.call("trame.lifecycle.update",[t])},sendError(t){return e.call("trame.error.client",[t])},getState(){return e.call("trame.state.get",[])},trigger(t,s=[],r={}){return e.call("trame.trigger",[t,s,r])},updateState(t){return e.call("trame.state.update",[t])},subscribeToStateUpdate(t){return e.subscribe("trame.state.topic",t)},subscribeToActions(t){return e.subscribe("trame.actions.topic",t)},unsubscribe(t){return e.unsubscribe(t)}}),p={SyncView:h,Trame:m};u.ZP.setSmartConnectClass(l.ZP);const d={},f={"http:":"ws:","https:":"wss:","ws:":"ws:","wss:":"wss:"},y=["unsubscribe","subscribeToViewChange","subscribeToStateUpdate","subscribeToActions","subscribeToViewChange"];function g(e){const t={...e};if(t.sessionURL){let e=t.sessionURL;const s=window.location;if(e.includes("USE_")){const t=new URL(e);t.protocol=f[s.protocol],e=t.toString()}const r={USE_HOSTNAME:s.hostname,USE_HOST:s.host};for(const[t,n]of Object.entries(r))e=e.replaceAll(t,n);t.sessionURL=e}return t.application=document.querySelector("html").dataset.appName||t.application,t.useUrl?{...t,...c.Z.extractURLParameters()}:t}function v(){return u.ZP.newInstance({protocols:p,configDecorator:g,notBusyList:y})}function b(e){let t=d[e]?.client;if(!t){t=v();const s=[],r={type:"created",message:"Client connected..."};function n(t){d[e].status=t}d[e]={client:t,status:r,subscriptions:s},s.push(t.onConnectionError((e=>{n({type:"Connection error",message:e?.response?.error})}))),s.push(t.onConnectionClose((e=>{n({type:"Connection close",message:e?.response?.error})})))}return t}function T(e){return d[e].status}var _={getClient:b,getStatus:T,configDecorator:g},w=s(9274),S=s(7117);const C={};function $(e,t){return e.priority-t.priority}function O(e){C.addAttachement=e}const R={priority:0,async decorate(e){if(null===e||void 0===e)return e;if(e.constructor&&e.constructor===File){const{name:t,lastModified:s,size:r,type:n}=e,i=await e.arrayBuffer(),a=C.addAttachement(i);return{name:t,lastModified:s,size:r,type:n,content:a,_filter:["content"]}}return e}},E={priority:0,async decorate(e){if(null===e||void 0===e)return e;if("string"===typeof e)return e;if(e.constructor&&e.constructor===FileList||e.length){const t=[];for(let s=0;s<e.length;s++)t.push(await R.decorate(e[s]));return t}return e}},U={priority:0,async decorate(e){if(null===e||void 0===e)return e;if("string"===typeof e)return e;if(e.constructor&&e.constructor===Object){const t={},s=Object.keys(e);for(let r=0;r<s.length;r++){const n=s[r];t[n]=e[n],t[n]=await E.decorate(t[n]),t[n]=await R.decorate(t[n])}return t}return e}},x=[R,E,U];function A(e){x.push(e),x.sort($)}async function j(e){let t=e;for(let s=0;s<x.length;s++){if(null===t||void 0===t)return t;t=await x[s].decorate(t)}return t}function k(e,t,s="application/octet-stream"){const r=new Blob([t],{type:s}),n=URL.createObjectURL(r),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((()=>URL.revokeObjectURL(n)),1e3)}function L(e,t=window){let s=t;const r=e.split(".");for(let n=0;n<r.length;n++)s=s[r[n]];return s}var D={download:k,get:L};function Z(e){const t={tts:0};return e.forEach((e=>{t[e]=0})),new r.Z({data:t})}function N(e,t){function s(e){for(let s=0;s<e.length;s++)t[e[s]]++}return e.$on("stateChange",s),()=>{e.$off("stateChange",s)}}function M(e,t,s){const r={};return t.forEach((t=>{r[t]={get(){return s[t],e.state.get(t)},set(s){e.state.set(t,s)}}})),r}const I={},P={};async function V(e,t){for(let s=0;s<e.length;s++)await t(e[s])}function B(e,t){const s=[],r={};for(let a=0;a<e.length;a++){let t=s,n=e[a];if(Array.isArray(n)){const e=n[1].serial;e&&(r[e]||(r[e]=[]),t=r[e]),[n]=n}t.push(n)}const n=s.map(t),i=Object.values(r);for(let a=0;a<i.length;a++)n.push(V(i[a],t));return Promise.all(n)}async function K(e,t,s=[]){const n=e=>!s.includes(e);e.includes("trame__styles")&&await B(t.trame__styles.filter(n),w.j),e.includes("trame__scripts")&&await B(t.trame__scripts.filter(n),w.ve),e.includes("trame__vue_use")&&t.trame__vue_use.forEach((e=>{let t=e,n={};Array.isArray(e)&&([t,n]=e);let i=D.get(t);i?P[t]||s.includes(t)||(P[t]=!0,i.default&&(i=i.default),console.info(`Vue.use(${t}, ${JSON.stringify(n)}) - ${!!i} - install(${!!i.install})`),i.install?(r.Z.use(i,n),i.getOptions&&Object.assign(I,i.getOptions())):r.Z.use({install:i},n)):console.error(`Lookup error: Vue.use(${t}, ${JSON.stringify(n)})`)})),e.includes("trame__favicon")&&t.trame__favicon&&(document.querySelector("link[rel=icon]").href=t.trame__favicon),e.includes("trame__title")&&t.trame__title&&(document.title=t.trame__title)}class z{constructor(e,t=null,s=[]){this.name="Default trame application",this.vueInstance=e,this.client=e?.client||t,this.exclude=e?.exclude||s,this.subscriptions=[],this.state={},this.keyTS={},this.ts=0,this.trameTemplateTS=0,this.trameTemplate={template:"<div>Too early for trame template</div>"},this.dirtyKeys=new Set,this.registerDecorator=A;const r=async e=>{const t=Object.keys(e);Object.assign(this.state,e),this.ts+=1;let s=0;for(let r=0;r<t.length;r++){const e=t[r];void 0===this.keyTS[e]&&s++,this.keyTS[e]=this.ts}if(await K(t,this.state,this.exclude),s&&(this.updateTrameTemplate(),this.vueInstance&&this.vueInstance.$emit("trameTemplateChange",this.trameTemplateTS)),this.vueInstance&&(this.vueInstance.$emit("stateChange",t),this.vueInstance.$router&&e?.trame__routes?.length)){const t=this.vueInstance.$router;e.trame__routes.forEach((e=>{t.addRoute(e)}))}};this.subscriptions.push(this.client.getRemote().Trame.subscribeToStateUpdate((([e])=>r(e)))),this.client.getRemote().Trame.getState().then((({state:t,name:s})=>{this.name=s,r(t),e&&(e.ready=!0)})),this._updateFromServer=r}updateTrameTemplate(){if(!this.vueInstance)return;this.trameTemplateTS+=1;const e=Object.keys(this.state),t=Z(e),s=N(this.vueInstance,t),r=M(this.vueInstance,e,t);let n=0;this.trameTemplate={name:"TrameTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"}},components:{VRuntimeTemplate:S.Z},computed:{...r,contentTemplate(){const e=`trame__template_${this.templateName}`;return this[e]||`<div>No state variable for ${e} with the following state.<br><pre>${JSON.stringify(this.trame.state.get(),null,2)}</pre></div>`},tts(){return t.tts}},watch:{contentTemplate(){setTimeout((()=>t.tts+=1),10)}},methods:{set(e,t){return this.trame.state.set(e,t)},get(e=null){return this.trame.state.get(e)},setAll(e){return this.trame.state.update(e)},flushState(...e){return this.trame.state.flush(...e)},registerDecorator(...e){return this.trame.state.registerDecorator(...e)},async trigger(e,t=[],s={}){return await this.trame.client.getRemote().Trame.trigger(e,t,s)},getRef(e){const{trameTemplateRootRef:t}=this.$refs;return t.$refs&&t.$refs[e]?t.$refs[e]:t.$children[0].$refs[e]},execAction(e){const{ref:t,type:s}=e,r=this.getRef(t);if(r&&"method"===s){const{method:t,args:s}=e;r[t](...s)}if(r&&"property"===s){const{property:t,value:s}=e;r[t]=s}}},created(){n++,this.utils=D,this.onActions=([e])=>{for(let t=0;t<e.length;t++)this.execAction(e[t])},this.clientSub=this.trame.client.getRemote().Trame.subscribeToActions(this.onActions)},beforeDestroy(){n--,0===n&&s(),this.trame.client.getRemote().Trame.unsubscribe(this.clientSub)},template:'<v-runtime-template ref="trameTemplateRootRef" :template="contentTemplate" />'}}delete(){while(this.subscriptions.length)this.client.getRemote().Trame.unsubscribe(this.subscriptions.pop())}get(e){return void 0===e?this.state:this.state[e]}getTimeStamp(e){return this.keyTS[e]||0}async set(e,t){this.ts+=1,this.state[e]=t,this.keyTS[e]=this.ts,this.dirty(e),await this.flush()}async update(e){this.ts+=1;for(const[t,s]of Object.entries(e))this.state[t]=s,this.keyTS[t]=this.ts,this.dirty(t);await this.flush()}canDirty(e){return!this.state.trame__client_only.includes(e)}dirty(...e){e.forEach((e=>{this.canDirty(e)?this.dirtyKeys.add(e):this.vueInstance&&this.vueInstance.$emit("stateChange",[e])}))}async flush(...e){if(e.length&&e.forEach((e=>{Array.isArray(e)?this.dirty(...e):this.dirty(e)})),this.dirtyKeys.size&&!this.client.isBusy()){const e=[],t=[];this.dirtyKeys.forEach((s=>{e.push(j(this.state[s])),t.push(s)})),this.dirtyKeys.clear();const s=await Promise.all(e),r=t.map(((e,t)=>({key:e,value:s[t]})));await this.client.getRemote().Trame.updateState(r)}this.vueInstance&&!this.vueInstance.connected&&this._updateFromServer(this.state)}}var F={name:"TrameConnect",props:{name:{type:String,default:"TrameConnect"},config:{type:Object,default:()=>({application:"trame"})},exclude:{type:Array,default:()=>[]},useUrl:{type:Boolean,default:!1},forwardErrors:{type:Boolean,default:!1}},data(){return{ready:!1,connected:!1,busy:1,status:{type:"created",message:"Connecting..."}}},async created(){if(this.subscriptions=[],this.client=_.getClient(this.name),this.subscriptions.push(this.client.onBusyChange((e=>{const t=!e!==!this.busy;this.busy=e,t&&this.state&&this.state.set("trame__busy",e),0===e&&this.state.flush(),t&&this.$emit("busyChange",e)}))),this.subscriptions.push(this.client.onConnectionError((e=>{this.connected=!1,this.status={type:"Connection error",message:e?.response?.error},this.reportError(e?.response?.error||"Connection error"),this.$emit("statusChange",this.status)}))),this.subscriptions.push(this.client.onConnectionClose((e=>{this.connected=!1,this.status={type:"Connection close",message:e?.response?.error},this.reportError(e?.response?.error||"Connection close"),this.$emit("statusChange",this.status)}))),this.client.isConnected()?(this.status=_.getStatus(this.name),this.$emit("statusChange",this.status)):(await this.client.connect(_.configDecorator({...this.config,useUrl:this.useUrl})),O(this.client.getConnection().getSession().addAttachment),this.status={type:"Connected"}),this.connected=this.client.isConnected(),this.busy=this.client.isBusy(),this.$emit("statusChange",this.status),this.connected&&(this.state=new z(this)),this.client.getRemote().Trame.lifeCycleUpdate("client_connected"),window.addEventListener("beforeunload",(()=>this.client.getRemote().Trame.lifeCycleUpdate("client_exited"))),this.forwardErrors){const e=console.error;console.error=(...t)=>{try{this.client.getRemote().Trame.sendError(t.join(" "))}catch(s){e(s)}finally{e(...t)}},window.addEventListener("error",(e=>{console.error(`${e.type}: ${e.message}`)}))}},beforeDestroy(){this.client.getRemote().Trame.lifeCycleUpdate("client_unmounted");while(this.subscriptions.length)this.subscriptions.pop().unsubscribe();this.state&&(this.state.delete(),this.state=null)},methods:{reportError(e="Something unexpected happened..."){this.state.set("trame__template_main",`<trame-loading message="${e}"/>`)}},provide(){return{trame:this}}},H=F,q=s(1001),J=(0,q.Z)(H,a,o,!1,null,null,null),G=J.exports,Q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("trame-template",{key:e.trameTemplateTS,attrs:{templateName:e.tName}})},W=[],X={name:"TrameServerTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"},urlKey:{type:String,default:"ui"},useUrl:{type:Boolean,default:!1}},data(){return{trameTemplateTS:0}},computed:{tName(){return this.useUrl&&c.Z.extractURLParameters()[this.urlKey]?c.Z.extractURLParameters()[this.urlKey]:this.templateName}},created(){this.onNewTemplate=()=>{this.$options.components.trameTemplate=this.trame.state.trameTemplate,this.trameTemplateTS=this.trame.state.trameTemplateTS},this.trame.$on("trameTemplateChange",this.onNewTemplate),this.onNewTemplate()},beforeDestroy(){this.trame.$off("trameTemplateChange",this.onNewTemplate)}},Y=X,ee=(0,q.Z)(Y,Q,W,!1,null,null,null),te=ee.exports,se={name:"App",components:{TrameConnect:G,TrameServerTemplate:te}},re=se,ne=(0,q.Z)(re,n,i,!1,null,null,null),ie=ne.exports,ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"none"}})},oe=[],ce={name:"TrameClientStateChange",props:{value:{type:String,default:""}},watch:{value(e){this.$nextTick((()=>{this.$emit("change",e)}))}}},le=ce,ue=(0,q.Z)(le,ae,oe,!1,null,null,null),he=ue.exports,me=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"none"}})},pe=[],de={name:"TrameClientTriggers",methods:{emit(e,t){this.$emit(e,t)}},created(){this.emit("created")},mounted(){this.emit("mounted")},beforeDestroy(){this.emit("beforeDestroy"),this.emit("beforeUnmount")}},fe=de,ye=(0,q.Z)(fe,me,pe,!1,null,null,null),ge=ye.exports,ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div")},be=[],Te={name:"TrameLifeCycleMonitor",props:{name:{type:String,default:"TrameLifeCycleMonitor"},type:{type:String,default:"log"},value:{type:String,default:"value"},events:{type:Array,default:()=>["created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed"]}},created(){this.events.includes("created")&&console[this.type](this.name,`created(${this._uid})`,this.value)},beforeMount(){this.events.includes("beforeMount")&&console[this.type](this.name,`beforeMount(${this._uid})`,this.value)},mounted(){this.events.includes("mounted")&&console[this.type](this.name,`mounted(${this._uid})`,this.value)},beforeUpdate(){this.events.includes("beforeUpdate")&&console[this.type](this.name,`beforeUpdate(${this._uid})`,this.value)},updated(){this.events.includes("updated")&&console[this.type](this.name,`updated(${this._uid})`,this.value)},beforeDestroy(){this.events.includes("beforeDestroy")&&console[this.type](this.name,`beforeDestroy(${this._uid})`,this.value)},destroyed(){this.events.includes("destroyed")&&console[this.type](this.name,`destroyed(${this._uid})`,this.value)}},_e=Te,we=(0,q.Z)(_e,ve,be,!1,null,null,null),Se=we.exports,Ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.$style.container},[s("div",{class:e.$style.loader}),s("div",{class:e.$style.message},[e._v(" "+e._s(e.message)+" ")])])},$e=[],Oe={name:"Loading",props:{message:{type:String,default:"Loading..."}}},Re=Oe,Ee={container:"style_container_VCsHx",loader:"style_loader_CNsNi",spin:"style_spin_BAaPb",message:"style_message_rmggO"};function Ue(e){this["$style"]=Ee.locals||Ee}var xe,Ae,je=(0,q.Z)(Re,Ce,$e,!1,Ue,null,null),ke=je.exports,Le=s(2441),De=s.n(Le),Ze={name:"TrameMouseTrap",inject:["trame"],props:{mapping:{type:Array}},created(){this.processMapping()},beforeDestroy(){De().reset()},watch:{mapping(){this.processMapping()}},methods:{processMapping(){this.mapping&&(De().reset(),this.mapping.forEach((({keys:e,event:t,stop:s,listen:r})=>{De().bind(e,(e=>{if(this.$emit(t,e),s)return!1}),r)})))},bind(...e){De().bind(...e)},unbind(e){De().unbind(e)},trigger(e){De().trigger(e)},addKeycodes(...e){De().trigger(...e)}}},Ne=Ze,Me=(0,q.Z)(Ne,xe,Ae,!1,null,null,null),Ie=Me.exports,Pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{overflow:"hidden",position:"relative",width:"100%",height:"100%",margin:"0",padding:"0"}},[e._t("default")],2)},Ve=[],Be={name:"TrameSizeObserver",props:{name:{type:String}},created(){this.observer=new ResizeObserver((()=>{if(!this.$el)return;const e=this.$el.getBoundingClientRect(),t=window.devicePixelRatio,s=96*t,r={size:e,pixelRatio:t,dpi:s};this.name&&(r.name=this.name),this.set&&this.set(this.name,r),this.$emit("change",r)}))},mounted(){this.observer.observe(this.$el)},beforeUnmount(){this.observer.unobserve(this.$el)},inject:["set"]},Ke=Be,ze=(0,q.Z)(Ke,Pe,Ve,!1,null,null,null),Fe=ze.exports,He=function(){var e=this,t=e.$createElement;e._self._c;return e._t("default",null,null,e.state)},qe=[];function Je(...e){const t={};for(let s=0;s<e.length;s++)t[e[s]]=null;return t}function Ge(e,t,...s){return r=>{const{state:n}=e,i=new Set(r);for(let e=0;e<s.length;e++){const r=s[e];i.has(r)&&(t[r]=n.get(r))}}}var Qe={inject:["trame"],name:"TrameStateResolver",props:{names:{type:Array,default:()=>[]}},data(){return Je(...this.names)},computed:{state(){const e={trame:this.trame,set:(...e)=>this.trame.state.set(...e)};for(let t=0;t<this.names.length;t++){const s=this.names[t];e[s]=this[s]}return e}},created(){this.onStateChange=Ge(this.trame,this,...this.names),this.trame.$on("stateChange",this.onStateChange),this.onStateChange(this.names)},beforeDestroy(){this.trame.$off("stateChange",this.onStateChange)},provide(){return{state:this}}},We=Qe,Xe=(0,q.Z)(We,He,qe,!1,null,null,null),Ye=Xe.exports,et={TrameApp:ie,TrameClientStateChange:he,TrameClientTriggers:ge,TrameConnect:G,TrameLifeCycleMonitor:Se,TrameLoading:ke,TrameMouseTrap:Ie,TrameServerTemplate:te,TrameSizeObserver:Fe,TrameStateResolver:Ye},tt={install(e){Object.keys(et).forEach((t=>{e.component(t,et[t])}))}};const st="TrameConnect";function rt(){const e=_.getStatus(st),t=document.querySelector(".trame__message");t&&(t.innerHTML=e.message||e.type)}async function nt(e){window.Vue=e,e.use(tt);const t=_.getClient(st);try{await t.connect(_.configDecorator({application:"trame",useUrl:!0}))}catch(r){return void rt()}t.onConnectionError(rt),t.onConnectionClose(rt),O(t.getConnection().getSession().addAttachment);const{state:s}=await t.getRemote().Trame.getState();await K(Object.keys(s),s),new e({...I,render:e=>e(ie)}).$mount("#app")}nt(r.Z)}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,r,n,i){if(!r){var a=1/0;for(u=0;u<e.length;u++){r=e[u][0],n=e[u][1],i=e[u][2];for(var o=!0,c=0;c<r.length;c++)(!1&i||a>=i)&&Object.keys(s.O).every((function(e){return s.O[e](r[c])}))?r.splice(c--,1):(o=!1,i<a&&(a=i));if(o){e.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,n,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,i,a=r[0],o=r[1],c=r[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(c)var u=c(s)}for(t&&t(r);l<a.length;l++)i=a[l],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},r=self["webpackChunktrame_components"]=self["webpackChunktrame_components"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998],(function(){return s(673)}));r=s.O(r)})();
//# sourceMappingURL=app.6db3ae11.js.map